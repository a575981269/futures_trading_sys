# 期货交易系统GUI界面

## 概述

这是期货量化交易系统的可视化界面，基于PyQt6开发，采用传统交易软件风格（多窗口/标签页布局）。

## 功能模块

### 1. 连接配置
- CTP连接配置（经纪商代码、用户代码、密码等）
- 环境选择（CTP主席系统/7x24环境）
- 服务器地址自动选择

### 2. 行情显示
- K线图表（基于PyQtGraph）
- 实时Tick数据显示
- 技术指标叠加（MA5、MA10、MA20、MA60）
- 合约订阅管理

### 3. 交易面板
- 快速下单（限价/市价）
- 持仓列表（实时更新）
- 订单列表（待成交、已成交、已撤销）
- 一键平仓功能

### 4. 账户信息
- 账户资金信息（总资产、可用资金、占用保证金等）
- 持仓明细（持仓盈亏、盈亏比例）
- 资金曲线图

### 5. 策略管理
- 策略列表
- 策略参数配置
- 策略启停控制
- 策略性能统计

### 6. 回测功能
- 回测参数配置（策略、时间范围、初始资金等）
- 回测结果展示（收益曲线、回撤、胜率等）
- 性能指标表格

### 7. 风控监控
- 风控指标实时显示
- 告警信息列表
- 风控规则配置

### 8. 订单管理
- 订单列表（所有订单状态）
- 成交记录
- 订单统计和筛选

### 9. 日志查看
- 系统日志显示
- 交易日志显示
- 日志过滤和搜索

## 运行方式

### 方式1：直接运行Python脚本

```bash
python gui/main.py
```

### 方式2：打包成.exe文件

1. 安装PyInstaller（如果尚未安装）：
```bash
pip install PyInstaller
```

2. 使用build.spec文件打包：
```bash
pyinstaller build.spec
```

3. 打包完成后，可执行文件位于 `dist/FuturesTradingSystem.exe`

## 使用说明

1. **启动程序**：运行 `python gui/main.py` 或双击 `FuturesTradingSystem.exe`

2. **连接CTP**：
   - 点击菜单栏"文件" -> "连接CTP" 或工具栏"连接"按钮
   - 在连接配置对话框中输入CTP连接参数
   - 选择环境类型（CTP主席系统或7x24环境）
   - 点击"连接"按钮

3. **订阅行情**：
   - 切换到"行情"标签页
   - 输入合约代码（如：rb2501）
   - 点击"订阅"按钮

4. **下单交易**：
   - 切换到"交易"标签页
   - 输入合约代码、选择方向、价格、数量
   - 点击"买入"或"卖出"按钮

5. **查看账户**：
   - 切换到"账户"标签页
   - 查看账户资金、持仓、盈亏等信息

## 快捷键

- `Ctrl+C`: 连接CTP
- `Ctrl+D`: 断开连接
- `Ctrl+M`: 显示行情窗口
- `Ctrl+T`: 显示交易窗口
- `Ctrl+A`: 显示账户窗口
- `Ctrl+S`: 显示策略窗口
- `Ctrl+B`: 显示回测窗口
- `Ctrl+R`: 显示风控窗口
- `Ctrl+O`: 显示订单窗口
- `Ctrl+L`: 显示日志窗口
- `Ctrl+Q`: 退出程序

## 注意事项

1. **首次使用**：需要配置CTP连接参数（在.env文件中或通过连接配置对话框）

2. **环境选择**：
   - CTP主席系统：仅在正常交易时间开放
   - 7x24环境：全天候开放，适合测试

3. **数据更新**：所有数据通过信号槽机制实时更新，确保线程安全

4. **性能优化**：大量数据更新时，系统会自动进行数据采样和虚拟滚动优化

## 技术架构

- **GUI框架**: PyQt6
- **图表库**: PyQtGraph
- **业务逻辑**: 通过SignalBridge进行线程安全的数据传递
- **数据流**: CTP接口 → 事件回调 → SignalBridge → GUI更新

## 开发说明

GUI界面采用模块化设计：
- `gui/main.py`: 应用程序入口
- `gui/main_window.py`: 主窗口
- `gui/widgets/`: 各个功能窗口组件
- `gui/charts/`: 图表组件
- `gui/utils/`: 工具类（信号桥接、主题样式）
- `gui/business_logic.py`: 业务逻辑集成层

## 故障排除

1. **无法连接CTP**：
   - 检查网络连接
   - 确认CTP连接参数正确
   - 确认选择的环境类型正确
   - 检查是否在交易时间内（CTP主席系统）

2. **界面无响应**：
   - 检查是否有大量数据更新
   - 尝试重启程序

3. **图表不显示**：
   - 确认已订阅合约
   - 检查是否有数据返回

## 后续开发

- [ ] 添加更多技术指标
- [ ] 优化图表性能
- [ ] 添加策略编辑器
- [ ] 添加数据导出功能
- [ ] 添加更多主题样式


